{
  "bash_script": "#!/usr/bin/env bash\nset -euo pipefail\n\nROOT_DIR=\"golden-py-ms\"\nmkdir -p \"$ROOT_DIR\"\ncd \"$ROOT_DIR\"\n\ngit init\nmkdir -p \"db\"\nmkdir -p \"db/init\"\nmkdir -p \"migrations\"\nmkdir -p \"services\"\nmkdir -p \"services/orders\"\nmkdir -p \"services/orders/app\"\nmkdir -p \"services/orders/app/db\"\nmkdir -p \"services/orders/app/middleware\"\nmkdir -p \"services/orders/app/utils\"\nmkdir -p \"services/users\"\nmkdir -p \"services/users/app\"\nmkdir -p \"services/users/app/db\"\nmkdir -p \"services/users/app/middleware\"\nmkdir -p \"services/users/app/utils\"\n\ncat \u003e \".gitignore\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\n# StackSprint\n.env\n*.log\n.DS_Store\n__pycache__/\n.venv/\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"README.md\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\n# StackSprint Generated Project\n\nLanguage: python\nFramework: fastapi\nArchitecture: microservices\nDatabase: mongodb\n\n## Run\n\n```bash\ndocker compose up --build\n```\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"db/init/001_init.sql\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\ndb = db.getSiblingDB('app');\ndb.createCollection('items');\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"docker-compose.yaml\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nservices:\n  users:\n    build: ./services/users\n    ports:\n      - \"9001:9001\"\n    env_file:\n      - ./services/users/.env\n    depends_on:\n      mongo:\n        condition: service_healthy\n  orders:\n    build: ./services/orders\n    ports:\n      - \"9002:9002\"\n    env_file:\n      - ./services/orders/.env\n    depends_on:\n      mongo:\n        condition: service_healthy\n  mongo:\n    image: mongo:8\n    ports:\n      - \"27017:27017\"\n    healthcheck:\n      test: [\"CMD-SHELL\", \"mongosh --quiet --eval 'db.adminCommand({ ping: 1 })'\"]\n      interval: 5s\n      timeout: 5s\n      retries: 12\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"migrations/001_initial.sql\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\n// MongoDB migrations are usually handled by migration tools at runtime.\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/.env\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nPORT=9002\nDATABASE_URL=mongodb://mongo:27017/app\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/Dockerfile\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nFROM python:3.12-slim\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY . .\nEXPOSE 8080\nCMD [\"uvicorn\", \"app.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8080\"]\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/app/db.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nimport os\n\nDATABASE_URL = os.getenv('DATABASE_URL', '')\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/app/db/retry.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nimport json\nimport logging\nimport time\n\n\nlogger = logging.getLogger(\"stacksprint.db\")\n\n\ndef connect_with_retry(connect_fn, max_retries=10):\n    for attempt in range(1, max_retries + 1):\n        try:\n            connect_fn()\n            logger.info(json.dumps({\"event\": \"db_connected\", \"attempt\": attempt}))\n            return\n        except Exception as exc:\n            if attempt == max_retries:\n                logger.error(\n                    json.dumps(\n                        {\n                            \"event\": \"db_connect_failed\",\n                            \"attempt\": attempt,\n                            \"max_retries\": max_retries,\n                            \"error\": str(exc),\n                        }\n                    )\n                )\n                raise RuntimeError(\"database connection failed after retries\") from exc\n\n            wait_seconds = 2 ** (attempt - 1)\n            logger.warning(\n                json.dumps(\n                    {\n                        \"event\": \"db_connect_retry\",\n                        \"attempt\": attempt,\n                        \"next_wait_ms\": wait_seconds * 1000,\n                        \"error\": str(exc),\n                    }\n                )\n            )\n            time.sleep(wait_seconds)\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/app/health.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\ndef health():\n    return {\"status\": \"ok\"}\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/app/items.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nfrom fastapi import APIRouter\n\nrouter = APIRouter(prefix='/items')\n\n@router.get('')\ndef list_items():\n    return [{\"id\": 1, \"name\": \"sample\"}]\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/app/main.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nfrom fastapi import FastAPI\n\napp = FastAPI(title='StackSprint')\n\n@app.get('/health')\ndef health():\n    return {'status': 'ok', 'architecture': 'microservices'}\n\n@app.get('/api/v1/items')\ndef list_items():\n    return [{'id': 1, 'name': 'sample'}]\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/app/middleware/request_id.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nimport uuid\nfrom starlette.middleware.base import BaseHTTPMiddleware\n\n\nclass RequestIDMiddleware(BaseHTTPMiddleware):\n    async def dispatch(self, request, call_next):\n        request_id = request.headers.get(\"X-Request-ID\") or str(uuid.uuid4())\n        request.state.request_id = request_id\n        response = await call_next(request)\n        response.headers[\"X-Request-ID\"] = request_id\n        return response\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/app/middleware/request_logging.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nimport json\nimport logging\nimport time\nfrom starlette.middleware.base import BaseHTTPMiddleware\n\n\nlogger = logging.getLogger(\"stacksprint.request\")\n\n\nclass RequestLoggingMiddleware(BaseHTTPMiddleware):\n    async def dispatch(self, request, call_next):\n        started_at = time.perf_counter()\n        response = await call_next(request)\n        latency_ms = int((time.perf_counter() - started_at) * 1000)\n\n        payload = {\n            \"event\": \"request_complete\",\n            \"method\": request.method,\n            \"path\": request.url.path,\n            \"status_code\": response.status_code,\n            \"latency_ms\": latency_ms,\n            \"request_id\": getattr(request.state, \"request_id\", None),\n        }\n        logger.info(json.dumps(payload))\n        return response\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/app/models.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nfrom pydantic import BaseModel\n\nclass Item(BaseModel):\n    id: int\n    name: str\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/app/routes.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nBASE_PATH = '/api/v1'\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/app/utils/pagination.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nDEFAULT_LIMIT = 20\nMAX_LIMIT = 100\n\n\ndef parse_pagination(params):\n    raw_limit = params.get(\"limit\")\n    try:\n        limit = int(raw_limit) if raw_limit is not None else DEFAULT_LIMIT\n    except (TypeError, ValueError):\n        limit = DEFAULT_LIMIT\n    if limit \u003c= 0:\n        limit = DEFAULT_LIMIT\n    if limit \u003e MAX_LIMIT:\n        limit = MAX_LIMIT\n\n    raw_offset = params.get(\"offset\")\n    try:\n        offset = int(raw_offset) if raw_offset is not None else 0\n    except (TypeError, ValueError):\n        offset = 0\n    if offset \u003c 0:\n        offset = 0\n\n    return limit, offset\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/orders/requirements.txt\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nfastapi==0.116.0\nuvicorn==0.34.0\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/.env\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nPORT=9001\nDATABASE_URL=mongodb://mongo:27017/app\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/Dockerfile\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nFROM python:3.12-slim\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY . .\nEXPOSE 8080\nCMD [\"uvicorn\", \"app.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8080\"]\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/app/db.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nimport os\n\nDATABASE_URL = os.getenv('DATABASE_URL', '')\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/app/db/retry.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nimport json\nimport logging\nimport time\n\n\nlogger = logging.getLogger(\"stacksprint.db\")\n\n\ndef connect_with_retry(connect_fn, max_retries=10):\n    for attempt in range(1, max_retries + 1):\n        try:\n            connect_fn()\n            logger.info(json.dumps({\"event\": \"db_connected\", \"attempt\": attempt}))\n            return\n        except Exception as exc:\n            if attempt == max_retries:\n                logger.error(\n                    json.dumps(\n                        {\n                            \"event\": \"db_connect_failed\",\n                            \"attempt\": attempt,\n                            \"max_retries\": max_retries,\n                            \"error\": str(exc),\n                        }\n                    )\n                )\n                raise RuntimeError(\"database connection failed after retries\") from exc\n\n            wait_seconds = 2 ** (attempt - 1)\n            logger.warning(\n                json.dumps(\n                    {\n                        \"event\": \"db_connect_retry\",\n                        \"attempt\": attempt,\n                        \"next_wait_ms\": wait_seconds * 1000,\n                        \"error\": str(exc),\n                    }\n                )\n            )\n            time.sleep(wait_seconds)\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/app/health.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\ndef health():\n    return {\"status\": \"ok\"}\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/app/items.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nfrom fastapi import APIRouter\n\nrouter = APIRouter(prefix='/items')\n\n@router.get('')\ndef list_items():\n    return [{\"id\": 1, \"name\": \"sample\"}]\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/app/main.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nfrom fastapi import FastAPI\n\napp = FastAPI(title='StackSprint')\n\n@app.get('/health')\ndef health():\n    return {'status': 'ok', 'architecture': 'microservices'}\n\n@app.get('/api/v1/items')\ndef list_items():\n    return [{'id': 1, 'name': 'sample'}]\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/app/middleware/request_id.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nimport uuid\nfrom starlette.middleware.base import BaseHTTPMiddleware\n\n\nclass RequestIDMiddleware(BaseHTTPMiddleware):\n    async def dispatch(self, request, call_next):\n        request_id = request.headers.get(\"X-Request-ID\") or str(uuid.uuid4())\n        request.state.request_id = request_id\n        response = await call_next(request)\n        response.headers[\"X-Request-ID\"] = request_id\n        return response\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/app/middleware/request_logging.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nimport json\nimport logging\nimport time\nfrom starlette.middleware.base import BaseHTTPMiddleware\n\n\nlogger = logging.getLogger(\"stacksprint.request\")\n\n\nclass RequestLoggingMiddleware(BaseHTTPMiddleware):\n    async def dispatch(self, request, call_next):\n        started_at = time.perf_counter()\n        response = await call_next(request)\n        latency_ms = int((time.perf_counter() - started_at) * 1000)\n\n        payload = {\n            \"event\": \"request_complete\",\n            \"method\": request.method,\n            \"path\": request.url.path,\n            \"status_code\": response.status_code,\n            \"latency_ms\": latency_ms,\n            \"request_id\": getattr(request.state, \"request_id\", None),\n        }\n        logger.info(json.dumps(payload))\n        return response\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/app/models.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nfrom pydantic import BaseModel\n\nclass Item(BaseModel):\n    id: int\n    name: str\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/app/routes.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nBASE_PATH = '/api/v1'\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/app/utils/pagination.py\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nDEFAULT_LIMIT = 20\nMAX_LIMIT = 100\n\n\ndef parse_pagination(params):\n    raw_limit = params.get(\"limit\")\n    try:\n        limit = int(raw_limit) if raw_limit is not None else DEFAULT_LIMIT\n    except (TypeError, ValueError):\n        limit = DEFAULT_LIMIT\n    if limit \u003c= 0:\n        limit = DEFAULT_LIMIT\n    if limit \u003e MAX_LIMIT:\n        limit = MAX_LIMIT\n\n    raw_offset = params.get(\"offset\")\n    try:\n        offset = int(raw_offset) if raw_offset is not None else 0\n    except (TypeError, ValueError):\n        offset = 0\n    if offset \u003c 0:\n        offset = 0\n\n    return limit, offset\nEOF_STACKSPRINT_GEN_9942\n\ncat \u003e \"services/users/requirements.txt\" \u003c\u003c'EOF_STACKSPRINT_GEN_9942'\nfastapi==0.116.0\nuvicorn==0.34.0\nEOF_STACKSPRINT_GEN_9942\n\necho \"StackSprint project generated successfully.\"\necho \"Run: docker compose up --build\"\n",
  "powershell_script": "$ErrorActionPreference = 'Stop'\n\n$RootDir = 'golden-py-ms'\nNew-Item -ItemType Directory -Path $RootDir -Force | Out-Null\nSet-Location $RootDir\n\ngit init\nNew-Item -ItemType Directory -Path 'db' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'db/init' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'migrations' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'services' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'services/orders' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'services/orders/app' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'services/orders/app/db' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'services/orders/app/middleware' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'services/orders/app/utils' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'services/users' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'services/users/app' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'services/users/app/db' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'services/users/app/middleware' -Force | Out-Null\nNew-Item -ItemType Directory -Path 'services/users/app/utils' -Force | Out-Null\n\n@'\n# StackSprint\n.env\n*.log\n.DS_Store\n__pycache__/\n.venv/\n'@ | Set-Content -NoNewline '.gitignore'\n\n@'\n# StackSprint Generated Project\n\nLanguage: python\nFramework: fastapi\nArchitecture: microservices\nDatabase: mongodb\n\n## Run\n\n```bash\ndocker compose up --build\n```\n'@ | Set-Content -NoNewline 'README.md'\n\n@'\ndb = db.getSiblingDB('app');\ndb.createCollection('items');\n'@ | Set-Content -NoNewline 'db/init/001_init.sql'\n\n@'\nservices:\n  users:\n    build: ./services/users\n    ports:\n      - \"9001:9001\"\n    env_file:\n      - ./services/users/.env\n    depends_on:\n      mongo:\n        condition: service_healthy\n  orders:\n    build: ./services/orders\n    ports:\n      - \"9002:9002\"\n    env_file:\n      - ./services/orders/.env\n    depends_on:\n      mongo:\n        condition: service_healthy\n  mongo:\n    image: mongo:8\n    ports:\n      - \"27017:27017\"\n    healthcheck:\n      test: [\"CMD-SHELL\", \"mongosh --quiet --eval 'db.adminCommand({ ping: 1 })'\"]\n      interval: 5s\n      timeout: 5s\n      retries: 12\n'@ | Set-Content -NoNewline 'docker-compose.yaml'\n\n@'\n// MongoDB migrations are usually handled by migration tools at runtime.\n'@ | Set-Content -NoNewline 'migrations/001_initial.sql'\n\n@'\nPORT=9002\nDATABASE_URL=mongodb://mongo:27017/app\n'@ | Set-Content -NoNewline 'services/orders/.env'\n\n@'\nFROM python:3.12-slim\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY . .\nEXPOSE 8080\nCMD [\"uvicorn\", \"app.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8080\"]\n'@ | Set-Content -NoNewline 'services/orders/Dockerfile'\n\n@'\nimport os\n\nDATABASE_URL = os.getenv('DATABASE_URL', '')\n'@ | Set-Content -NoNewline 'services/orders/app/db.py'\n\n@'\nimport json\nimport logging\nimport time\n\n\nlogger = logging.getLogger(\"stacksprint.db\")\n\n\ndef connect_with_retry(connect_fn, max_retries=10):\n    for attempt in range(1, max_retries + 1):\n        try:\n            connect_fn()\n            logger.info(json.dumps({\"event\": \"db_connected\", \"attempt\": attempt}))\n            return\n        except Exception as exc:\n            if attempt == max_retries:\n                logger.error(\n                    json.dumps(\n                        {\n                            \"event\": \"db_connect_failed\",\n                            \"attempt\": attempt,\n                            \"max_retries\": max_retries,\n                            \"error\": str(exc),\n                        }\n                    )\n                )\n                raise RuntimeError(\"database connection failed after retries\") from exc\n\n            wait_seconds = 2 ** (attempt - 1)\n            logger.warning(\n                json.dumps(\n                    {\n                        \"event\": \"db_connect_retry\",\n                        \"attempt\": attempt,\n                        \"next_wait_ms\": wait_seconds * 1000,\n                        \"error\": str(exc),\n                    }\n                )\n            )\n            time.sleep(wait_seconds)\n'@ | Set-Content -NoNewline 'services/orders/app/db/retry.py'\n\n@'\ndef health():\n    return {\"status\": \"ok\"}\n'@ | Set-Content -NoNewline 'services/orders/app/health.py'\n\n@'\nfrom fastapi import APIRouter\n\nrouter = APIRouter(prefix='/items')\n\n@router.get('')\ndef list_items():\n    return [{\"id\": 1, \"name\": \"sample\"}]\n'@ | Set-Content -NoNewline 'services/orders/app/items.py'\n\n@'\nfrom fastapi import FastAPI\n\napp = FastAPI(title='StackSprint')\n\n@app.get('/health')\ndef health():\n    return {'status': 'ok', 'architecture': 'microservices'}\n\n@app.get('/api/v1/items')\ndef list_items():\n    return [{'id': 1, 'name': 'sample'}]\n'@ | Set-Content -NoNewline 'services/orders/app/main.py'\n\n@'\nimport uuid\nfrom starlette.middleware.base import BaseHTTPMiddleware\n\n\nclass RequestIDMiddleware(BaseHTTPMiddleware):\n    async def dispatch(self, request, call_next):\n        request_id = request.headers.get(\"X-Request-ID\") or str(uuid.uuid4())\n        request.state.request_id = request_id\n        response = await call_next(request)\n        response.headers[\"X-Request-ID\"] = request_id\n        return response\n'@ | Set-Content -NoNewline 'services/orders/app/middleware/request_id.py'\n\n@'\nimport json\nimport logging\nimport time\nfrom starlette.middleware.base import BaseHTTPMiddleware\n\n\nlogger = logging.getLogger(\"stacksprint.request\")\n\n\nclass RequestLoggingMiddleware(BaseHTTPMiddleware):\n    async def dispatch(self, request, call_next):\n        started_at = time.perf_counter()\n        response = await call_next(request)\n        latency_ms = int((time.perf_counter() - started_at) * 1000)\n\n        payload = {\n            \"event\": \"request_complete\",\n            \"method\": request.method,\n            \"path\": request.url.path,\n            \"status_code\": response.status_code,\n            \"latency_ms\": latency_ms,\n            \"request_id\": getattr(request.state, \"request_id\", None),\n        }\n        logger.info(json.dumps(payload))\n        return response\n'@ | Set-Content -NoNewline 'services/orders/app/middleware/request_logging.py'\n\n@'\nfrom pydantic import BaseModel\n\nclass Item(BaseModel):\n    id: int\n    name: str\n'@ | Set-Content -NoNewline 'services/orders/app/models.py'\n\n@'\nBASE_PATH = '/api/v1'\n'@ | Set-Content -NoNewline 'services/orders/app/routes.py'\n\n@'\nDEFAULT_LIMIT = 20\nMAX_LIMIT = 100\n\n\ndef parse_pagination(params):\n    raw_limit = params.get(\"limit\")\n    try:\n        limit = int(raw_limit) if raw_limit is not None else DEFAULT_LIMIT\n    except (TypeError, ValueError):\n        limit = DEFAULT_LIMIT\n    if limit \u003c= 0:\n        limit = DEFAULT_LIMIT\n    if limit \u003e MAX_LIMIT:\n        limit = MAX_LIMIT\n\n    raw_offset = params.get(\"offset\")\n    try:\n        offset = int(raw_offset) if raw_offset is not None else 0\n    except (TypeError, ValueError):\n        offset = 0\n    if offset \u003c 0:\n        offset = 0\n\n    return limit, offset\n'@ | Set-Content -NoNewline 'services/orders/app/utils/pagination.py'\n\n@'\nfastapi==0.116.0\nuvicorn==0.34.0\n'@ | Set-Content -NoNewline 'services/orders/requirements.txt'\n\n@'\nPORT=9001\nDATABASE_URL=mongodb://mongo:27017/app\n'@ | Set-Content -NoNewline 'services/users/.env'\n\n@'\nFROM python:3.12-slim\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY . .\nEXPOSE 8080\nCMD [\"uvicorn\", \"app.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8080\"]\n'@ | Set-Content -NoNewline 'services/users/Dockerfile'\n\n@'\nimport os\n\nDATABASE_URL = os.getenv('DATABASE_URL', '')\n'@ | Set-Content -NoNewline 'services/users/app/db.py'\n\n@'\nimport json\nimport logging\nimport time\n\n\nlogger = logging.getLogger(\"stacksprint.db\")\n\n\ndef connect_with_retry(connect_fn, max_retries=10):\n    for attempt in range(1, max_retries + 1):\n        try:\n            connect_fn()\n            logger.info(json.dumps({\"event\": \"db_connected\", \"attempt\": attempt}))\n            return\n        except Exception as exc:\n            if attempt == max_retries:\n                logger.error(\n                    json.dumps(\n                        {\n                            \"event\": \"db_connect_failed\",\n                            \"attempt\": attempt,\n                            \"max_retries\": max_retries,\n                            \"error\": str(exc),\n                        }\n                    )\n                )\n                raise RuntimeError(\"database connection failed after retries\") from exc\n\n            wait_seconds = 2 ** (attempt - 1)\n            logger.warning(\n                json.dumps(\n                    {\n                        \"event\": \"db_connect_retry\",\n                        \"attempt\": attempt,\n                        \"next_wait_ms\": wait_seconds * 1000,\n                        \"error\": str(exc),\n                    }\n                )\n            )\n            time.sleep(wait_seconds)\n'@ | Set-Content -NoNewline 'services/users/app/db/retry.py'\n\n@'\ndef health():\n    return {\"status\": \"ok\"}\n'@ | Set-Content -NoNewline 'services/users/app/health.py'\n\n@'\nfrom fastapi import APIRouter\n\nrouter = APIRouter(prefix='/items')\n\n@router.get('')\ndef list_items():\n    return [{\"id\": 1, \"name\": \"sample\"}]\n'@ | Set-Content -NoNewline 'services/users/app/items.py'\n\n@'\nfrom fastapi import FastAPI\n\napp = FastAPI(title='StackSprint')\n\n@app.get('/health')\ndef health():\n    return {'status': 'ok', 'architecture': 'microservices'}\n\n@app.get('/api/v1/items')\ndef list_items():\n    return [{'id': 1, 'name': 'sample'}]\n'@ | Set-Content -NoNewline 'services/users/app/main.py'\n\n@'\nimport uuid\nfrom starlette.middleware.base import BaseHTTPMiddleware\n\n\nclass RequestIDMiddleware(BaseHTTPMiddleware):\n    async def dispatch(self, request, call_next):\n        request_id = request.headers.get(\"X-Request-ID\") or str(uuid.uuid4())\n        request.state.request_id = request_id\n        response = await call_next(request)\n        response.headers[\"X-Request-ID\"] = request_id\n        return response\n'@ | Set-Content -NoNewline 'services/users/app/middleware/request_id.py'\n\n@'\nimport json\nimport logging\nimport time\nfrom starlette.middleware.base import BaseHTTPMiddleware\n\n\nlogger = logging.getLogger(\"stacksprint.request\")\n\n\nclass RequestLoggingMiddleware(BaseHTTPMiddleware):\n    async def dispatch(self, request, call_next):\n        started_at = time.perf_counter()\n        response = await call_next(request)\n        latency_ms = int((time.perf_counter() - started_at) * 1000)\n\n        payload = {\n            \"event\": \"request_complete\",\n            \"method\": request.method,\n            \"path\": request.url.path,\n            \"status_code\": response.status_code,\n            \"latency_ms\": latency_ms,\n            \"request_id\": getattr(request.state, \"request_id\", None),\n        }\n        logger.info(json.dumps(payload))\n        return response\n'@ | Set-Content -NoNewline 'services/users/app/middleware/request_logging.py'\n\n@'\nfrom pydantic import BaseModel\n\nclass Item(BaseModel):\n    id: int\n    name: str\n'@ | Set-Content -NoNewline 'services/users/app/models.py'\n\n@'\nBASE_PATH = '/api/v1'\n'@ | Set-Content -NoNewline 'services/users/app/routes.py'\n\n@'\nDEFAULT_LIMIT = 20\nMAX_LIMIT = 100\n\n\ndef parse_pagination(params):\n    raw_limit = params.get(\"limit\")\n    try:\n        limit = int(raw_limit) if raw_limit is not None else DEFAULT_LIMIT\n    except (TypeError, ValueError):\n        limit = DEFAULT_LIMIT\n    if limit \u003c= 0:\n        limit = DEFAULT_LIMIT\n    if limit \u003e MAX_LIMIT:\n        limit = MAX_LIMIT\n\n    raw_offset = params.get(\"offset\")\n    try:\n        offset = int(raw_offset) if raw_offset is not None else 0\n    except (TypeError, ValueError):\n        offset = 0\n    if offset \u003c 0:\n        offset = 0\n\n    return limit, offset\n'@ | Set-Content -NoNewline 'services/users/app/utils/pagination.py'\n\n@'\nfastapi==0.116.0\nuvicorn==0.34.0\n'@ | Set-Content -NoNewline 'services/users/requirements.txt'\n\nWrite-Host 'StackSprint project generated successfully.'\nWrite-Host 'Run: docker compose up --build'\n",
  "file_paths": [
    ".gitignore",
    "README.md",
    "db",
    "db/init",
    "db/init/001_init.sql",
    "docker-compose.yaml",
    "migrations",
    "migrations/001_initial.sql",
    "services",
    "services/orders",
    "services/orders/.env",
    "services/orders/Dockerfile",
    "services/orders/app",
    "services/orders/app/db",
    "services/orders/app/db.py",
    "services/orders/app/db/retry.py",
    "services/orders/app/health.py",
    "services/orders/app/items.py",
    "services/orders/app/main.py",
    "services/orders/app/middleware",
    "services/orders/app/middleware/request_id.py",
    "services/orders/app/middleware/request_logging.py",
    "services/orders/app/models.py",
    "services/orders/app/routes.py",
    "services/orders/app/utils",
    "services/orders/app/utils/pagination.py",
    "services/orders/requirements.txt",
    "services/users",
    "services/users/.env",
    "services/users/Dockerfile",
    "services/users/app",
    "services/users/app/db",
    "services/users/app/db.py",
    "services/users/app/db/retry.py",
    "services/users/app/health.py",
    "services/users/app/items.py",
    "services/users/app/main.py",
    "services/users/app/middleware",
    "services/users/app/middleware/request_id.py",
    "services/users/app/middleware/request_logging.py",
    "services/users/app/models.py",
    "services/users/app/routes.py",
    "services/users/app/utils",
    "services/users/app/utils/pagination.py",
    "services/users/requirements.txt"
  ],
  "warnings": [],
  "decisions": [
    {
      "code": "stack.core",
      "category": "stack",
      "message": "Language=python, Framework=fastapi, Architecture=microservices."
    },
    {
      "code": "arch.microservices",
      "category": "architecture",
      "message": "Generated 2 services with http communication."
    },
    {
      "code": "db.selected",
      "category": "database",
      "message": "Database=mongodb with ORM disabled."
    },
    {
      "code": "output.compose",
      "category": "output",
      "message": "docker-compose.yaml included."
    },
    {
      "code": "output.dockerfile",
      "category": "output",
      "message": "Dockerfile boilerplate included."
    },
    {
      "code": "output.readme",
      "category": "output",
      "message": "README.md included."
    },
    {
      "code": "output.tree",
      "category": "output",
      "message": "Generated 31 files and 14 directories."
    }
  ]
}
